{% extends "base.html" %}
{% block head %}
{% block title %}{% endblock %}
<link rel="stylesheet" href="{{url_for('static',filename='loan-risk-assessment.css')}}">

<style>
/* ✅ Loading overlay styles */
#loadingOverlay {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.8);
    text-align: center;
    padding-top: 20%;
    font-size: 1.5rem;
    color: #333;
}
</style>
{% endblock %}

{% block body %}
<div class="container">
    <h1>Loan Risk Assessment</h1>
    
    <!-- Loan Form -->
    <form action="" method="POST" id="loanForm">
        {{ form.hidden_tag() }}

        <label>Preferred Language for the advice</label>
        {{ form.language() }}
        
        <label>Desired Loan Amount (KES)</label>
        {{ form.loan_amount() }}
        
        <label>Monthly Income (KES)</label>
        {{ form.monthly_income() }}
        
        <label>Business Type</label>
        {{ form.business_type() }}
        
        <label>Business Level</label>
        {{ form.business_level() }}
        
        <label>Business Description</label>
        {{ form.business_desc() }}
        
        <label>Preferred Repayment Period (Months)</label>
        {{ form.repayment_period() }}

        {{ form.submit() }}
    </form>

    <!-- ✅ Show download button only after PDF is ready -->
    {% if advice_file %}
        <div style="margin-top:20px;">
            <a href="{{ url_for('static', filename='reports/' ~ advice_file) }}" 
               class="btn btn-success" download>
                ⬇️ Download Your Advice Report
            </a>
        </div>
    {% endif %}
</div>

<!-- ✅ Loading Overlay -->
<div id="loadingOverlay">
    <div>⏳ Generating financial advice... Please wait</div>
</div>

<script>
    // Show loading overlay on form submit
    const form = document.getElementById("loanForm");
    if (form) {
        form.addEventListener("submit", function() {
            document.getElementById("loadingOverlay").style.display = "block";
        });
    }
</script>
{% endblock %}
